{% extends "::base.html.twig" %}

{% block title %}{{ bar.name }} | World Best Bars{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        /**
         * TODO : Créer des fonction JS pour gérer cette partie
         */
        var barId = "{{ bar.id }}",
                venue  = "{{ bar.foursquare }}",
                insta = "{{ bar.instagram }}",
                imgs = [],
                i, m, n, reste, lastImages,
                fsq = [],
                ins = [],
                html = "";
        $(document).ready(function(){
            $('#showOpenings').click(function(){
                var link = $(this);
                $('.openings').toggle();
                if ($('.openings').is(':visible')) {
                    link.text('(Show less)');
                } else {
                    link.text('(See all)');
                }
            });
            $.ajax({
                type: "POST",
                url:  Routing.generate('wbb_bar_feeds_list',
                        { type: "fsimgs", bar: barId }),
                dataType: 'json',
                success: function(r) {
                    $.ajax({
                        type: "POST",
                        url:  Routing.generate('wbb_bar_feeds_find',
                                { type: "fsimgs", id: venue }),
                        dataType: 'json',
                        success: function(response) {
                            i = 0;
                            $.each(response.data, function(key, feed){
                                if(in_array(feed.id, r) && i<5) {
                                    fsq.push('<div class="image"><div class="content"><div class="overlay"></div><a class="btn-round foursquare dark"></a><img src="'+feed.prefix+"640x480"+feed.suffix+'"/></div></div>');
                                    i++;
                                }
                            });
                            $.ajax({
                                type: "POST",
                                url:  Routing.generate('wbb_bar_feeds_list',
                                        { type: "instagram", bar: barId}),
                                dataType: 'json',
                                success: function(r) {
                                    $.ajax({
                                        type: "POST",
                                        url:  Routing.generate('wbb_bar_feeds_find',
                                                { type: "instagram", id: insta}),
                                        dataType: 'json',
                                        success: function(response) {
                                            i = 0;
                                            $.each(response.data.data, function(key, feed){
                                                if(!in_array(feed.id, r) && i<5) {
                                                    ins.push('<div class="image"><div class="content"><div class="overlay"></div><a class="btn-round instagram dark"></a><img src="'+feed.images.standard_resolution.url+'"/></div></div>');
                                                    i++;
                                                }
                                            });
                                            for(i=0; i<=4; i+=2){
                                                if(typeof ins[i] != 'undefined') { html+=ins[i]; }
                                                if(typeof ins[i+1] != 'undefined') { html+=ins[i+1]; }
                                                if(typeof fsq[i] != 'undefined') { html+=fsq[i]; }
                                                if(typeof fsq[i+1] != 'undefined') { html+=fsq[i+1]; }
                                            }
                                            $('.ui-slide').append(html);
                                            imgs = $('.image');
                                            $('.ui-slide').remove();
                                            html = "";
                                            for(n=0; n<Math.ceil(imgs.length/4); n++){
                                                html+='<div class="ui-slide">';
                                                for(m=n*4; m<(n+1)*4; m++){
                                                    if(imgs[m]){
                                                        html+=nodeToString(imgs[m]);
                                                    }
                                                }
                                                html+='</div>';
                                            }
                                            //$('.ui-slide>div:nth-child(4n)').after('</div><div class="ui-slide">');
                                            $(".loader").css('display','none');
                                            $('.ui-slider').append(html);
                                            reste  = 4-$('.ui-slide .image').length%4;
                                            lastImages = $('.ui-slide .image').slice(-reste);
                                            i=1;
                                            $.each(lastImages, function(key, element){
                                                if(i<=reste){
                                                    $('.ui-slide:last-child').append('<div class="image">'+element.innerHTML+'</div>');
                                                }
                                                i++;
                                            });
                                            //$('.ui-slider:last-child').append();
                                            //$('.ui-slider:last-child').append($('.ui-slide .image:nth-last-child('+reste+')'));
                                            initializeSliders();
                                        },
                                        error: function(e) {
                                            console.log(e);
                                        }
                                    });
                                },
                                error: function(e) {
                                    console.log(e);
                                }
                            });

                        },
                        error: function(e) {
                            console.log(e);
                        }
                    });
                },
                error: function(e) {
                    console.log(e);
                }
            });
        });
    </script>
{% endblock %}
{% block bodyTag %}
<body class="bar-details">
{% endblock %}
{% block body %}
    <!-- SUBHEADER -->
<div class="container">
    <section class="sub-header">
        <table>
            <tr>
                {% if not is_mobile() %}
                <td>
                    <div class="city-selector h3">
                        You are in
                        <a class="btn-radius with-icon border brown place" href="">{{ bar.city.name|default('Unspecified') }}</a>
                    </div>                        </td>
                {% endif %}
                <td class="title">
                    <h1>{{ bar.name }}</h1>
                    <h3>{{ bar.suburb.name|default('Unspecified') }}, {{ bar.city.name|default('Unspecified') }}</h3>
                </td>

                <td class="star-share">
                    <a class="btn-round brown star" href=""></a><a class="btn-round brown share" href=""></a>
                </td>
            </tr>
        </table>
    </section>
</div>
    <!-- SLIDER -->
    <div class="container full">
    <section class="gallery">
        <div class="main">
            <div class="image">
                <div class="content">
                    <div class="overlay"></div>
                    {% for m in bar.medias|slice(0,1) %}
                        <img src="{% path m.media, 'slider_large' %}" />
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="ui-slider type-bar-detail has_sizer arrows infinite" data-size="4x3" data-animation="latency">
            <img class="loader" src="{{ asset('bundles/wbbbar/img/loader.gif') }}" alt="" />
            <div class="ui-slide" style="display:none">
                {% for m in bar.medias %}

                    {% if not loop.first %}
                    <div class="image">
                        <div class="content">
                            <div class="overlay"></div>
                            <img src="{% path m.media, 'slider_small' %}"/>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </section>
    </div>
<div class="container">
<section class="content">
        <!-- MAIN CONTENT -->
        <article class="main">
            {% if not is_mobile() %}<div class="twelve columns h1 l-margin-top mobile-out">About the bar</div>{% endif %}
            <div class="eight columns l-margin-top">
                <p>
                    <strong>At a Glance:&nbsp;&nbsp;</strong>
                    {% for tr in bar.tags %}
                    {{ tr.tag }}{% if not loop.last %}&nbsp;&nbsp;∙&nbsp;&nbsp;{% endif %}
                    {% endfor%}<br/>
                    <br/>
                    {{ bar.description }}
                </p>
                <!-- ALSO APPEARS -->
                {% if not is_mobile() %}
                <div class="also-appears">
                    <hr class="l-margin"/>
                    <div class="m-margin-top h2">This bar appears also in</div>
                    <div class="m-margin-top h3">
                        <ul>
                            <li>
                                <a href="">
                                    Interview with Nick Miller
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    Best Cocktails Bars in New York
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    The Bar Project from Ballantine’s
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>
            <!-- ASIDE -->
            <aside class="columns four">
                <div class="block informations">
                    <div class="contain">
                        <div class="gmap">
                            <div class="get-directions h4">
                                <a href="http://maps.google.com/maps?q={{ bar.latitude }},{{ bar.longitude }}" class="btn-small-radius border brown" target="_blank">Get Directions</a>
                            </div>
                            <img src="http://maps.googleapis.com/maps/api/staticmap?center={{ bar.latitude }},{{ bar.longitude }}&zoom=16&size=660x240&maptype=roadmap&sensor=false"/>
                        </div>
                        <p>
                            {{ bar.address }}<br/>
                            {{ bar.city }}<br/>
                            {{ bar.phone }}<br/>
                            <a href="mailto:{{ bar.email }}">{{ bar.email }}</a>
                            <br/>
                            {% if bar.website %}<a href="{{ bar.website }}" class="btn-small-round www brown" target="_blank"></a>{% endif %}
                            {% if bar.twitter %}<a href="http://www.twitter.com/{{ bar.twitter }}" class="btn-small-round twitter" target="_blank"></a>{% endif %}
                            {% if bar.facebook %}<a href="https://www.facebook.com/{{ bar.facebook }}" class="btn-small-round facebook" target="_blank"></a>{% endif %}
                            {% if bar.foursquare %}<a href="https://www.foursquare.com/v/{{ bar.foursquare }}" class="btn-small-round foursquare" target="_blank"></a>{% endif %}
                            {% if bar.instagram %}<a href="https://www.instagram.com/{{ bar.instagram }}" class="btn-small-round instagram" target="_blank"></a>{% endif %}
                        </p>
                        <hr class="s-margin"/>
                        <div class="p">
                            Hours: Today
                            {% for opening in bar.openings %}
                                {% if opening.openingDay == "now"|date("N") %}
                                    {{ opening.fromHour }}:00 - {{ opening.toHour }}:00
                                {% endif %}
                            {% endfor%}
                            <a href="#0" id="showOpenings">(See all)</a><br/>
                            <span class="openings" style="display: none">
                            {% set days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"] %}
                                {% for opening in bar.openings %}
                                    &nbsp;&nbsp;&nbsp;&nbsp;{{ days[opening.openingDay-1] }} : {{ opening.fromHour }}:00 - {{ opening.toHour }}:00<br />
                                {% endfor%}
                            </span>
                            Accepts Credit Cards: {% if bar.isCreditCard %}Yes{% else %}No{% endif %}<br/>
                            Coat Check: {% if bar.isCoatCheck %}Yes{% else %}No{% endif %}<br/>
                            Parking: {{ bar.parking }}<br/>
                            Price: {% for i in 1..4 %}<span {% if i <= bar.price|number_format %}style="color:#b3955f"{% endif %}>$</span>{% endfor %} {% if bar.menu %}<a href="{{ bar.menu }}" target="_blank">(View menu)</a>{% endif %}<br/>
                            Reservation: {% if bar.isReservation %}Yes{% else %}No{% endif %}<br/>
                            {% if bar.reservation %}<a href="{{ bar.reservation }}" class="btn-small-radius border brown" target="_blank">Make a Reservation</a>{% endif %}
                        </div>
                    </div>
                </div>
                {% if not is_mobile() %}
                <div class="block">
                    <div class="side-ad m-margin-top">
                        <img src="{{ asset('/bundles/wbbcore/images/tmp/ad.side.jameson.png') }}" alt="ad.jameson" width="300" height="250"/>
                        <div class="txt">Advertising</div>
                    </div>
                </div>
                {% endif %}
            </aside>
        </article>
    </section>
</div>
    <!-- INSIDER TIPS -->
    <section class="insider-tips m-margin-top">

        <div class="container load-container">

            <div class="twelve columns align-center l-margin-top m-margin-bottom h1">
                Insider Tips
            </div>

            <div class="line">

                {% if not is_mobile() %}
                    <div class="three columns box">
                        <article class="tip">
                            <div class="content form">
                                <form>
                                    <h3>Leave a tip</h3>
                                    <textarea class="s-margin-top" name="" id="" placeholder="Type a tip ..."></textarea>
                                    <div class="m-margin-top h4 count">499 left</div>
                                    <input class="s-margin-top btn-small-radius brown" type="submit" value="Submit"/>
                                </form>
                                <br class="clear"/>
                            </div>
                        </article>
                    </div>
                {% endif %}


                <div class="three columns box">
                    <article class="tip">

                        <table class="content ">

                            <tbody>
                            <tr class="excerpt">
                                <td colspan="2">
                                    <div class="scroll">
                                        <img src="{{ asset('/bundles/wbbcore/images/icons/pin.foursquare-blue.png') }}" alt="icon.foursquare" width="30"
                                             height="30"><br>
                                        “NY. This Portuguese/ Chinese fusion restaurant offers an exciting blend of exotic dishes
                                        that make dining at Macao a unique experience.”
                                    </div>
                                </td>
                            </tr>


                            </tbody>
                        </table>
                    </article>
                </div>

                <div class="three columns box">
                    <article class="tip">

                        <table class="content expert">

                            <tr class="excerpt">
                                <td colspan="2">
                                    <div class="scroll">
                                        “NY. This Portuguese/ Chinese fusion restaurant offers an exciting blend of exotic dishes that make dining at Macao a unique experience.”
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="2">
                                    <hr class="s-margin-bottom"/>
                                </td>
                            </tr>

                            <tr class="author">
                                <td>
                                    <img src="{{ asset('/bundles/wbbcore/images/tmp/user.ryan.png') }}" alt="user" width="40" height="40"/>
                                </td>
                                <td>
                                    <b>Expert</b>
                                    Ryan Melon
                                </td>
                            </tr>


                        </table>
                    </article>
                </div>


                <div class="three columns box">
                    <article class="tip">

                        <table class="content ">

                            <tbody>
                            <tr class="excerpt">
                                <td colspan="2">
                                    <div class="scroll">
                                        <img src="{{ asset('/bundles/wbbcore/images/icons/pin.foursquare-blue.png') }}" alt="icon.foursquare" width="30"
                                             height="30"><br>
                                        “NY. This Portuguese/ Chinese fusion restaurant offers an exciting blend of exotic dishes
                                        that make dining at Macao a unique experience.”
                                    </div>
                                </td>
                            </tr>


                            </tbody>
                        </table>
                    </article>
                </div>

            </div>

            <div class="line load-target"></div>

            {% if is_mobile() %}

            <div class="twelve columns align-center m-margin">
                <a class="btn-radius border load-more brown" href="{{ asset('/bundles/wbbcore/images/tmp/data/tips.php') }}">Load More</a>
            </div>

                <div class="three columns box">
                    <article class="tip">
                        <div class="content form">
                            <form>
                                <h3>Leave a tip</h3>
                                <textarea class="s-margin-top" name="" id="" placeholder="Type a tip ..."></textarea>
                                <div class="m-margin-top h4 count">499 left</div>
                                <input class="s-margin-top btn-small-radius brown" type="submit" value="Submit"/>
                            </form>
                            <br class="clear"/>
                        </div>
                    </article>
                </div>

            {% else %}

            <div class="twelve columns align-center m-margin">
                <a class="btn-radius border load-more brown" href="{{ asset('/bundles/wbbcore/images/tmp/data/tips.php') }}">Load More</a>
            </div>

            {% endif %}
        </div>

    </section>
    <!-- ALSO APPEARS -->
    {% if is_mobile() %}
    <div class="container">
        <div class="twelve columns">
            <div class="also-appears">
                <div class="m-margin-top h2">This bar appears also in</div>
                <div class="m-margin-top h3">
                    <ul>
                        <li>
                            <a href="">
                                Interview with Nick Miller
                            </a>
                        </li>
                        <li>
                            <a href="">
                                Best Cocktails Bars in New York
                            </a>
                        </li>
                        <li>
                            <a href="">
                                The Bar Project from Ballantine’s
                            </a>
                        </li>
                    </ul>
                </div>
                <hr class="l-margin-top"/>
            </div>
        </div>
    </div>
    {% endif %}
    <!-- ALSO LIKE -->
    <section class="also-like">
        <div class="container m-padding-bottom">
            <div class="h1 twelve columns align-center l-margin-top m-margin-bottom">
                {% if oneCity %}Related bars in {{ bar.city.name }}{% else %}You May Also Like{% endif %}
            </div>
            {% for b in barLike %}
                <div class="three columns">
                    {% if is_mobile() %}
                        <article class="bar-wo-pic">
                            <a href="" class="btn-round dark star"></a>
                            <div class="txt">
                                <h2>{{ b.name }}</h2>
                                <h3>{{ b.suburb.name }}, {{ b.city.name }}</h3>
                            </div>
                            <a href="/bar/{{ bar.id }}/details" class="overlay-link"></a>
                        </article>
                    {% else %}
                    <article class="bar-w-pic">
                        <a href="" class="btn-round dark star"></a>
                        <div class="txt">
                            <h2>{{ b.name }}</h2>
                            <h3>{{ b.suburb.name }}, {{ b.city.name }}</h3>
                            <div class="tags">
                                {% for tr in b.tags %}
                                    {{ tr.tag }}{% if not loop.last %}, {% endif %}
                                {% endfor%}
                            </div>
                        </div>
                        <a href="/bar/{{ bar.id }}/details" class="overlay-link"></a>
                        <div class="gradient"></div>
                        {% for m in b.medias|slice(0,1) %}
                            <img class="scale-with-grid" src="{% path m.media, 'slider_large' %}"  alt="{{ b.name }}" width="570" height="428"/>
                        {% endfor %}
                    </article>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </section>
    <!-- AD -->
    {% if not is_mobile() %}

        <section class="footer-ad">
            <div class="container align-center">
                <div class="twelve columns">
                    <hr/>
                    <img class="m-margin scale-with-grid" src="{{ asset('/bundles/wbbcore/images/tmp/ad.pre-footer.jpg') }}" alt="ad.chivas" width="728" height="90"/>
                </div>
            </div>
        </section>

    {% endif %}
{% endblock %}




