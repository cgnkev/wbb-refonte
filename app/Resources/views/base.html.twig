<!DOCTYPE html>
<html lang="fr" class="utf8">
    <head>
        <meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1, initial-scale=1"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta charset="utf-8"/>

        {% block meta %}
            <meta name="description" content="{% block mDescription %}World Best Bars{% endblock %}" />
        {% endblock %}

        <title>{% block title %}{{ "World Best Bars"|trans }}{% endblock %}</title>
        <link rel="icon" type="image/png" href="{{ asset('bundles/wbbcore/images/favicon.png') }}" />

        <!--[if lt IE 9]>
        <script src="{{ asset('bundles/wbbcore/js/plugins/html5.js') }}"></script>
        <![endif]-->
        <script type="text/javascript">
            var ismobile, istablet;
            ismobile = 0;
            istablet = 0;
            {% if is_mobile() and not is_tablet() %}ismobile = 1;{% endif %}
            {% if is_tablet() %}istablet = 1;{% endif %}
            {% if city is defined and city != ''  %}
                window.isCity = true;
            {% endif %}
            var DEBUGMODE = "{{app.environment }}";
        </script>

        <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
        <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>

        {% block stylesheets %}

            {% stylesheets filter="cssrewrite"
                "bundles/wbbcore/css/front.css"
                "bundles/wbbcore/css/wbb.css"
                "bundles/wbbcore/css/main.css"
            %}
                {#  #}
            <link rel="stylesheet" href="{{ asset_url }}" />
            {% endstylesheets %}

            {#{% javascripts#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/jquery.min.js'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/jquery.mousewheel.js'#}
                {#'@WBBCoreBundle/Resources/public/js/geolocalisation.wbb.js'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/jquery.jscrollpane.js'#}
                {#'@WBBCoreBundle/Resources/public/js/plugins/jquery.cookie.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/utils.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/slider.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/ratio.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/loadMore.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/dropdown.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/selector.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/tips.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/radio.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/search.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/search.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/form.metabolism.js'#}
                {#'@WBBCoreBundle/Resources/public/js/app.js'#}
                {#'@WBBCoreBundle/Resources/public/js/wbb.js'#}
                {#'@WBBCoreBundle/Resources/public/js/libs/translate.wbb.js'#}
            {#%}#}
            {#<script type="text/javascript" src="{{ asset_url }}"></script>#}
            {#{% endjavascripts %}#}
        {% endblock %}

        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.min.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.easing.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.velocity.min.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.transform3d.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/modernizr.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.browser.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.touchSwipe.min.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/placeholders.min.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.mousewheel.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/geolocalisation.wbb.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.jscrollpane.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/plugins/jquery.cookie.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/utils.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/slider.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/ratio.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/loadMore.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/dropdown.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/selector.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/tips.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/radio.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/search.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/search.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/form.metabolism.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/app.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/wbb.js"></script>
        <script type="text/javascript" src="/bundles/wbbcore/js/libs/translate.wbb.js"></script>

        {% block javascripts %}

        {% endblock %}

        <script type="text/javascript">
                var MARKET = "US";
                var LANG = "en";
                var BASEURL = "{{ asset('bundles/wbbcore/') }}";
        </script>

        {% if is_tablet() %}
            <style type="text/css">
                article.bar-wo-pic:hover {
                    background: #faf3e1 !important;
                }
                article.bar-wo-pic:hover h2 {
                    color: #333 !important;
                }
                article.bar-wo-pic:hover h3 {
                    color: #B3955F !important;
                }
                article.bar-wo-pic .btn-round.star{
                    background : #faf3e1 !important;
                }
                article.bar-wo-pic .btn-round.star.active, article.bar-wo-pic .btn-round.star:hover {
                    border-color: transparent !important;
                    background: transparent !important;
                }
            </style>
        {% endif %}
    </head>

    {% block bodyTag %}
        <body>

        {% endblock %}

        {% if not is_granted("IS_AUTHENTICATED_REMEMBERED") %}
            <div id="register-light">
                {% render url('wbb_user_registration_register_light') %}
            </div>
            <script>
                jQuery(document).ready(function($) {
                    // Click anywhere on the page to get rid of lightbox window
                    $('.mask').hide();
                    $('.lighbox').click(function(e) {
                        e.preventDefault();
                        //Get clicked link data-show ID of tag to show
                        var id_content = $(this).attr("data-show");
                        var current_id = $("#" + id_content);
                        var mask = $(".mask");

                        if (current_id.length > 0) {
                            //show lightbox window
                            current_id.show('slow');
                            // Add class to trigger ID
                            current_id.addClass('void-popup');
                            //show the mask
                            mask.show('fast');
                        } else {
                            $('.mask').hide();
                            current_id.removeClass("void-popup");
                        }
                    })
                    $(".btn-close").click(function(e) {
                        var current_popup = $(this).closest(".void-popup");
                        current_popup.removeClass("void-popup");
                        current_popup.hide("fast");
                        $(".mask").hide("slow");
                    })
                });
                $(document).ready(function() {
                    $('#message').hide();
                    $('#register_form').on('submit', function(e) {
                        e.preventDefault();
                        var form = $(this);
                        var formUrl = '{{ path('wbb_user_registration_register_light') }}';

                        $.ajax({
                            type: "POST",
                            url: formUrl,
                            data: form.serialize(),
                            success: function(data) {
                                if (data.code === '400') {
                                    var errors = data.errors;
                                    var errorsList = $('#message').show().find('img').html('<ul></ul>');
                                    for (var i = 0; i < errors.length; i++) {
                                        errorsList.find('ul').append('<li>' + errors[i] + '</li>');
                                    }
                                } else {

                                }
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                                // Si erreur communication ?
                            }
                        });
                    });
                    $('#login_form').on('submit', function(e) {
                        e.preventDefault();
                        var form = $(this);
                        var formUrl = '{{ path('fos_user_security_check') }}';

                        $.ajax({
                            type: "POST",
                            url: formUrl,
                            data: form.serialize(),
                            success: function(data) {
                                console.log(data);
                                if (data.code === '400') {
                                    $('#login_error').html(data.error);
                                } else {
                                    window.location.reload();
                                }
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                                // Si erreur communication ?
                            }
                        });
                    });
                });
            </script>
        {% endif %}
        <div id="fb-root"></div>
        {{ facebook_initialize({'xfbml': true}) }}
        <script>
            $(document).ready(function() {
                $('#facebook-signup').on('click', function() {
                    FB.getLoginStatus(function(response) {
                        if (response.status === 'connected') {
                            FB.api('/me', function(response) {
                                console.log(response);
                                setTimeout(securityCheck, 500);
                            });
                        } else {
                            FB.login(function(response) {
                                if (response.authResponse) {
                                    console.log('Welcome!  Fetching your information.... ');
                                    setTimeout(securityCheck, 500);
                                } else {
                                    console.log('User cancelled login or did not fully authorize.');
                                }
                            });
                        }
                    });
                });
                function securityCheck() {
                    $.ajax({
                        url: '{{ path('_security_check') }}',
                        success: function(response) {
                            if (response.code === '400') {
                                alert('Create an account please !');
                            } else {
                                window.location.reload();
                            }
                        }
                    })
                }
            });
            function fillInForm(formId) {
                FB.getLoginStatus(function(response) {
                    if (response.status === 'connected') {
                        FB.api('/me', function(response) {
                            console.log(response);
                            if (formId === '#register_form_full') {
                                $(formId + ' #fos_user_registration_form_firstname').val(response.first_name);
                                $(formId + ' #fos_user_registration_form_lastname').val(response.last_name);
                                $(formId + ' #fos_user_registration_form_email').val(response.email);
                                if (response.gender === 'male') {
                                    $('#fos_user_registration_form_title').find('option[value="M"]').attr('selected', 'selected');
                                } else {
                                    $('#fos_user_registration_form_title').find('option[value="F"]').attr('selected', 'selected');
                                }
                            } else if (formId === '#register_form') {
                                $(formId + ' #fos_user_registration_form_email').val(response.email);
                            }
                        });
                    } else {
                        FB.login(function(response) {
                            if (response.authResponse) {
                                console.log('Welcome!  Fetching your information.... ');
                                fillInForm(formId);
                            } else {
                                console.log('User cancelled login or did not fully authorize.');
                            }
                        });
                    }
                });
            }
        </script>
        <script type="text/javascript">

            //twitter
            !function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
                if (!d.getElementById(id)) {
                    js = d.createElement(s);
                    js.id = id;
                    js.src = p + '://platform.twitter.com/widgets.js';
                    fjs.parentNode.insertBefore(js, fjs);
                }
            }(document, 'script', 'twitter-wjs');
        </script>
        {% block header %}
            {% include '::header.html.twig' %}
        {% endblock %}
        {% block body %}
        {% endblock %}
        <!-- AD -->
        {% block footerAd %}
            {% if not is_mobile() or is_tablet() %}
            {% include '::ads/adsFooter.html.twig' %}
            {% endif %}
            {#{{ render(controller('WBBBarBundle:Ads:show', { 'position': 'HP_728x90' })) }}#}
        {% endblock %}

        {% block footer %}
            {% include '::footer.html.twig' %}
        {% endblock %}
    </body>
</html>
