{% extends "::base.html.twig" %}
{% block meta %}<meta name="description" content="World Best Bars" />{% endblock %}
{% block title %}World Best Bars{% endblock %}
{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function(){
            {% if city is defined %}
            $.cookie('city', '{{ path('city_homepage',{slug:city.slug}) }}', { path: '/' });
            {% else %}
            $.cookie('city', {{ path('homepage') }}, { path: '/' });
            {% endif %}
            $(".star").click(function(){
                var btn = $(this);
                $.ajax({
                    type: "POST",
                    url:  '/',
                    success: function() {
                        if(btn.hasClass('active')){
                            btn.removeClass('active');
                            if(btn.hasClass('changed')){
                                btn.removeClass('brown');
                                btn.addClass('dark');
                                btn.removeClass('changed');
                            }
                            if(btn.hasClass('nc')){
                                btn.addClass('force-disabled')
                            }
                        }else{
                            btn.addClass('active');
                            if(btn.hasClass('dark')){
                                btn.addClass('changed');
                                btn.addClass('brown');
                                btn.removeClass('dark');
                            }
                            if(btn.hasClass('force-disabled')){
                                btn.removeClass('force-disabled')
                            }
                        }
                    }
                });
            });
            {% if city is defined %}
            $('.city-selector .city>span').html('{{ city.name }}');
            {% endif %}
            $('#criteria').change(function(){
                if($('input[name=filter]:checked').val()=='bar_list'){
                    if($('input[name=view-type]:checked').val()=='grid'){
                        $(".smbars").show();
                        $(".bars-grid").html('<div class="line load-target"></div><div class="twelve columns align-center m-margin load-more-container"> <a class="h4 btn-radius large border load-more brown smbars" href="#0" data-bar="1" data-city="0" data-filter="'+$(this).val()+'" data-offset="0" data-limit="9" data-type="bars" data-display="grid" >See more bars</a></div>');
                        new meta.LoadMore({$button:$(".smbars")});
                        $(".smbars").trigger('click');
                    }else{
                        $(".smbars2").show();
                        $(".bars-list").html('<div class="line load-target"></div><div class="twelve columns align-center m-margin load-more-container"> <a class="h4 btn-radius large border load-more brown smbars2" href="#0" data-bar="1" data-city="0" data-filter="'+$(this).val()+'" data-offset="0" data-limit="9" data-type="bars" data-display="list" >See more bars</a></div>');
                        new meta.LoadMore({$button:$(".smbars2")});
                        $(".smbars2").trigger('click');
                    }

                }else{
                    if($('input[name=view-type]:checked').val()=='grid'){
                        $(".smbestofs").show();
                        $(".bestofs-grid").html('<div class="line load-target"></div><div class="twelve columns align-center m-margin load-more-container"> <a class="h4 btn-radius large border load-more brown smbestofs" href="#0" data-bar="0" data-city="0" data-filter="'+$(this).val()+'" data-offset="0" data-limit="10" data-type="bars" data-display="grid" >See more best ofs</a></div>');
                        new meta.LoadMore({$button:$(".smbestofs")});
                        $(".smbestofs").trigger('click');
                    }else{
                        $(".smbestofs2").show();
                        $(".bestofs-list").html('<div class="line load-target"></div><div class="twelve columns align-center m-margin load-more-container"> <a class="h4 btn-radius large border load-more brown smbestofs2" href="#0" data-bar="0" data-city="0" data-filter="'+$(this).val()+'" data-offset="0" data-limit="10" data-type="bars" data-display="list" >See more best ofs</a></div>');
                        new meta.LoadMore({$button:$(".smbestofs2")});
                        $(".smbestofs2").trigger('click');
                    }
                }

            });
            initializeSliders();
        });
    </script>
{% endblock %}
{% block bodyTag %}
<body class="index">
{% endblock %}
{% block body %}
<style type="text/css">
    section.bar-filter .bars-w-pic {
        width: auto;
    }
</style>
<div class="full-cream">

    <!-- SUBHEADER -->
    <div class="container">

        <section class="sub-header">

            {% if not is_mobile() or is_tablet() %}
            <table>
                <tr>
                    <td>
                        <div class="city-selector h3">
                            You are in
                            <select class="ui-dropdown" name="city" data-class="with-icon city" id="city_selector">
                                <option disabled="disabled">Choose a City</option>
                                {% for c in topCities %}
                                    <option data-type="redirect" value="{{ path('wbb_bar_guides_city',{slug:c.slug}) }}"
                                            {% if city is defined and c.id==city.id %}
                                                selected="selected"
                                            {% endif %}
                                            >{{ c.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </td>

                    <td class="title">
                        <h1>Popular Bars</h1>
                    </td>

                    <td></td>
                </tr>
            </table>
            {% else %}
            <h1>Popular Bars</h1>
            {% endif %}
        </section>
    </div>

    <!-- BARS -->
    <div class="container full">

        <section class="bars">

            {% if is_mobile() and not is_tablet() %}

            <div class="force-load">
                {% for b in popularBars %}
                    {% include "WBBBarBundle:Bar:bar2.html.twig" with { 'b': b } %}
                {% endfor %}
            </div>

            {% else %}

            <div class="ui-slider type-bar has_sizer arrows dots" data-size="12x3" data-display="3">
                {% for b in popularBars %}
                    <div class="ui-slide">
                       {% include "WBBBarBundle:Bar:bar1.html.twig" with { 'b': b } %}
                    </div>
                {% endfor %}
            </div>

            {% endif %}

        </section>
    </div>

    <!-- BEST OF -->
    <div class="container">

        <div class="twelve columns">

            <section class="bestof">
                <div class="align-center l-margin">
                    <h1>Best Of</h1>
                </div>
                {% if is_mobile() and not is_tablet() %}
                    <div class="ui-slider type-bestof has_sizer arrows dots" data-size="4x3" data-display="1">
                {% else %}
                    <div class="ui-slider type-bestof has_sizer arrows dots" data-size="3x3" data-display="3">
                {% endif %}
                    {% for b in topBestofs %}
                        <div class="ui-slide">
                            {% include "WBBBarBundle:Bar:bestof.html.twig" with { 'b': b } %}
                        </div>
                    {% endfor %}
                </div>
            </section>
        </div>
    </div>

    <!-- BAR FILTER -->

    <section class="bar-filter">

        <div class="container s-margin-bottom">

            <div class="twelve columns">
                <hr class="l-margin-top m-margin-bottom"/>
            </div>

            <div class="six columns h2">

                <input type="radio" name="filter" value="bar_list" class="ui-radio" data-color="brown" data-type="collapsed" checked="checked"/>
                <input type="radio" name="filter" value="best_of" class="ui-radio" data-color="brown" data-type="collapsed"/>
            </div>

            <div class="six columns sort-by h3">

                <span class="sort">Sort by :</span>

                <select class="ui-dropdown light" name="criteria" id="criteria">
                    <option value="popularity" data-type="criteria">Popularity</option>
                    <option value="date" data-type="criteria">Date</option>
                    <option value="distance" data-type="criteria">Distance</option>
                    <option value="alphabetical" data-type="criteria">Alphabetical order</option>
                </select>

                <input type="radio" name="view-type" value="grid" class="ui-radio with-icon" data-color="brown" checked="checked"/>
                <input type="radio" name="view-type" value="list" class="ui-radio with-icon" data-color="brown"/>
            </div>
        </div>

        <div class="container">
            <div class="bar-list">
                <div class="bars-w-pic force-load {% if is_mobile() and not is_tablet() %}m-margin-top{% endif %} load-container bars-grid">
                    <div class='line first'>{{ render(controller('WBBBarBundle:Bar:barGuideFilter', { 'barsOnly' : 1, 'city' : 0 , 'filter' : 'popularity' , 'offset' : 0, 'limit' : 9, 'display' : 'grid' })) }}</div>
                    <div class="line load-target"></div>

                    <div class="twelve columns align-center m-margin load-more-container">
                        <a class="h4 btn-radius large border load-more brown smbars" href="#0" data-bar="1" data-city="0" data-filter="popularity" data-offset="8" data-limit="9" data-type="bars" data-display="grid" >See more bars</a>
                    </div>

                </div>

                <div class="bars-w-pic-list load-container bars-list" style="display: none">

                    <div class='line first'>{{ render(controller('WBBBarBundle:Bar:barGuideFilter', { 'barsOnly' : 1, 'city' : 0 , 'filter' : 'popularity' , 'offset' : 0, 'limit' : 9, 'display' : 'list' })) }}</div>
                    <div class="line load-target"></div>

                    <div class="twelve columns align-center m-margin load-more-container">
                        <a class="h4 btn-radius large border load-more brown smbars2" href="#0" data-bar="1" data-city="0" data-filter="popularity" data-offset="8" data-limit="9" data-type="bars" data-display="list" >See more bars</a>
                    </div>

                </div>
            </div>
            <div class="best-of" style="display: none;" >
                <div class="twelve columns type-bestof force-load {% if is_mobile() and not is_tablet() %}m-margin-top{% endif %} load-container bestofs-grid">
                    <div class='line first'>{{ render(controller('WBBBarBundle:Bar:barGuideFilter', { 'barsOnly' : 0, 'city' : 0 , 'filter' : 'popularity' , 'offset' : 0, 'limit' : 10 })) }}</div>
                    <div class="line load-target"></div>

                    <div class="twelve columns align-center m-margin load-more-container">
                        <a class="h4 btn-radius large border load-more brown smbestofs" href="#0" data-bar="0" data-city="0" data-filter="popularity" data-offset="8" data-limit="10" data-type="bars" data-display="grid" >See more best of</a>
                    </div>

                </div>

                <div class="load-container bestofs-list" style="display: none !important">

                    <div class='line first'>{{ render(controller('WBBBarBundle:Bar:barGuideFilter', { 'barsOnly' : 0, 'city' : 0 , 'filter' : 'popularity' , 'offset' : 0, 'limit' : 10 , 'display' : 'list', 'display': 'grid' })) }}</div>
                    <div class="line load-target"></div>

                    <div class="twelve columns align-center m-margin load-more-container">
                        <a class="h4 btn-radius large border load-more brown smbestofs2" href="#0" data-bar="0" data-city="0" data-filter="popularity" data-offset="8" data-limit="10" data-type="bars" data-display="list" >See more best of</a>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            $('input[name=filter]').change(function()
            {
                if( $('input[name=filter]:checked').val() == "bar_list")
                {
                    $('.best-of').fadeOut(200, 'easeInOutCubic', function()
                    {
                        $('.bar-list').show();

                    });
                }
                else
                {
                    $('.bar-list').fadeOut(200, 'easeInOutCubic', function()
                    {
                        $('.best-of').show();

                    });
                }
            });

            $('input[name=view-type]').change(function()
            {
                if( $('input[name=view-type]:checked').val() == "grid")
                {
                    $('.bars-w-pic-list').fadeOut(200, 'easeInOutCubic', function()
                    {
                        $('.bars-w-pic').show();

                        var $elements = $('.bars-w-pic article');

                        $elements.addClass('enable3d').css({opacity:0, top:'6em', position:'relative'}).each(function(index){

                            $(this).delay(60*(index+1)).velocity({opacity:1, top:0}, 600, 'easeInOutCubic');
                        });
                    });
                }
                else
                {
                    $('.bars-w-pic').fadeOut(200, 'easeInOutCubic', function()
                    {
                        $('.bars-w-pic-list').show();

                        var $elements = $('.bars-w-pic-list article');

                        $elements.addClass('enable3d').css({opacity:0, top:'6em', position:'relative'}).each(function(index){

                            $(this).delay(100*(index+1)).velocity({opacity:1, top:0}, 600, 'easeInOutCubic');
                        });
                    });
                }
            });

        </script>

    </section>
</div>
{% endblock %}