var meta=meta||{},globalAjaxCode;
meta.SearchPage=function(){var a=this,f="Bar",h="",m="";start=compteurNews=0;lastConsultedURL="";compteurBars=0;currentQuery=currentFilterLoaded="";from_loadMore=!1;currentTabActive="Bar";totalLoadedImage=0;a.config={speed:500,easing:"easeInOutCubic",container:""};a.context={};a._setupContext=function(){a.context.$form_filter=$("form#filter");a.context.$form_search=$("form#search")};a.template={barWithPicture:function(a,c,e,l,f){var d=(ismobile?"":'<div class="three columns m-margin-top">')+'<article class="bar-w-pic" data-type="%type">';
"News"!=a&&(d+='<a data-id="'+f.id+'" data-type="bar" data-name="'+f.name+'" href="'+e+'" class="btn-round dark star'+(c?" active ":"")+'"></a>');d+='<div class="txt">    <h2>%title</h2>';"News"!=a&&(d+="    <h3>%city, %country</h3>");"News"!=a&&(d+='    <div class="hover">',d+='        <div class="tags %tag-non-founed">%tags</div>',d+="    </div>");d+="</div>";d+='<a href="'+getBaseURL()+l+'" class="overlay-link"></a>';d+='<div class="color gradient"></div>';d+='<div class="color gray"></div>';d+=
'<img src="" class="image-search-item scale-with-grid" data-src="%img" alt="%title"/>';return d+="</article>"+(ismobile?"":"</div>")},barWithPictureList:function(a,c,e,l,f){var d=(ismobile?"":"<div>")+'<article class="bar-w-pic-list" data-type="%type">',d=d+'<div class="three columns s-margin-top">    <div class="bar-w-pic list">';"News"!=a&&(d+='<a data-id="'+f.id+'" data-type="bar" data-name="'+f.name+'" href="'+e+'" class="btn-round dark star'+(c?" active ":"")+'"></a>');d+='        <a href="'+
getBaseURL()+l+'" class="overlay-link"></a>';d+='        <img class="scale-with-grid image-search-item" src="" data-src="%img" alt="%title"/>';d+="    </div>";d+="</div>";d+=' <div class="nine columns s-margin-top">';d+='    <h2 class="s-margin-top"><a href="'+getBaseURL()+l+'">%title</a></h2>';d+='    <h3 class="xs-margin-top">%city, %country</h3>';d+='    <p class="s-margin-top">';d+="        %description";d+="    </p>";"News"!=a&&(d+='    <div class="tags %tag-non-founed">%tags</div>');d+=" </div>";
d+='  <div class="separator"><hr/></div>';return d+="</article>"+(ismobile?"":"</div>")}};a.clearContent=function(){$(".bars-w-pic-list .dist-target").empty();$(".bars-w-pic-list .dist-target").html("");$(".details-barlist .dist-target").empty();$(".details-barlist .dist-target").html("")};a.shortName=function(a,c,e){var f=a.length;return a.substr(0,c)+(f>c?e?e:"...":"")};a.escapit=function(a){return a.replace(RegExp("&","g"),"%26")};a.checkActiveTab=function(){var a=0;"News"==f&&(a=1);$(".screen-compteur").find("a").removeClass("active");
$($(".screen-compteur").find("a")[a]).addClass("active")};a._imageLoaded=function(){totalLoadedImage--;$(this).removeAttr("data-src");0==totalLoadedImage&&($(".loader-search-page").hide(),a._animate($(".load-target"),$(".dist-target .line:last-child").find("> *").not("br")))};a.generateListByResults=function(b,c,e){if(b.hits&&b.hits.hit&&0<b.hits.hit.length){var l="",h="",h="";$.each(b.hits.hit,function(d,b){var c=b.fields.favorite?b.fields.favorite:!1,e=b.fields.favorite_url?b.fields.favorite_url:
"#",n=b.fields.url?URL_MODE+b.fields.url:"#",g=a.template.barWithPicture(f,c,e,n,{id:b.fields.wbb_id,name:b.fields.name}).replace("%type",""),c=a.template.barWithPictureList(f,c,e,n,{id:b.fields.wbb_id,name:b.fields.name}).replace("%type","");-1<b.id.indexOf("News")?compteurNews++:-1<b.id.indexOf("Bar")&&compteurBars++;e=b.fields.name;g=g.replace(RegExp("%title","ig"),a.shortName(e,25));c=c.replace(RegExp("%title","ig"),a.shortName(e,35));b.fields.city?(g=g.replace("%city",b.fields.city),c=c.replace("%city",
b.fields.city)):(g=g.replace("%city",""),c=c.replace("%city",""));b.fields.country?(g=g.replace("%country",b.fields.country),c=c.replace("%country",b.fields.country)):(g=g.replace(", %country",""),c=c.replace(", %country",""));e=[];for(key in b.fields)-1<key.indexOf("tags_")&&$.isArray(b.fields[key])&&b.fields[key].length&&e.push(b.fields[key]);if(e&&e.length){for(var n="",m=0,p=0,r=e.length;p<r;p++)for(var q=0,s=e[p].length;q<s&&!(5<=m);q++)m++,n+="<a href='"+Routing.generate("wbb_cloudsearch_searchresults")+
"?tag="+a.escapit(e[p][q])+"'>"+e[p][q]+"</a> , ";n=n.substr(0,n.length-2);g=g.replace("%tags",n);c=c.replace("%tags",n);g=g.replace("%tags-non-founed","");c=c.replace("%tags-non-founed","")}else g=g.replace("%tags",""),g=g.replace("%tag-non-founed","display-none"),c=c.replace("%tags",""),c=c.replace("%tag-non-founed","display-none");b.fields.wbb_media_url?(g=g.replace(RegExp("%img","ig"),b.fields.wbb_media_url),c=c.replace(RegExp("%img","ig"),b.fields.wbb_media_url)):(g=g.replace(RegExp("%img","ig"),
defaultImg),c=c.replace(RegExp("%img","ig"),defaultImg));b.fields.slug&&(g=g.replace(RegExp("%link","ig"),b.fields.slug),c=c.replace(RegExp("%link","ig"),b.fields.slug));b.fields.seo_description?(g=g.replace("%description",b.fields.seo_description),c=c.replace("%description",b.fields.seo_description)):(g=g.replace("%description",""),c=c.replace("%description",""));l+=g;h+=c});$(".bars-w-pic-list .dist-target").append('<div class="line search-block-only">'+h+"</div>");$(".details-barlist .dist-target").append('<div class="line search-block-only">'+
l+"</div>");$(".image-search-item").error(function(){$(this).attr("src",defaultImg)});e=$(".bars-w-pic-list").add(".details-barlist").find("img[data-src]");totalLoadedImage=e.length;$(".dist-target .line:last-child").find("> *").not("br").css({opacity:0,top:"6em",position:"relative"});e.each(function(){$(this).load(a._imageLoaded);$(this).error(a._imageLoaded);$(this).attr("src",$(this).data("src"))})}else $(".loader-search-page").hide(),$(".load-more-bars-btn").hide(),$(".load-more-news-btn").hide(),
$(".bars-w-pic-list .dist-target").empty(),$(".details-barlist .dist-target").empty(),$(".details-barlist .dist-target").html(""),$(".bars-w-pic-list .dist-target").html(""),$(".bars-w-pic-list .dist-target").append("<p class='"+(ismobile?"text-align-center":"")+" no-result'>There are no results matching your request.</p>"),$(".details-barlist .dist-target").append("<p class='"+(ismobile?"text-align-center":"")+" no-result'>There are no results matching your request.</p>");c&&c();(function(){var c=
Number(b.hits.news),e=Number(b.hits.bars),f=function(a,b,c,d){a=$(".screen-compteur a[data-index=1]");b=$(".screen-compteur a[data-index=0]");0>=c?b.find("span").text("NO BAR"):1==c?b.find("span").text("(1) BAR"):b.find("span").text("("+c+") BARS");0>=d?a.find("span").text("NO NEWS"):1==d?a.find("span").text("(1) NEWS"):a.find("span").text("("+d+") NEWS")},l=$(".screen-compteur a[data-index=1]"),h=$(".screen-compteur a[data-index=0]");0<c?(a.desibledBtn(l,!0),f(c,l,e,c)):(a.desibledBtn(l,!1),f(0,
l,e,c));0<e?(a.desibledBtn(h,!0),f(e,h,e,c)):(a.desibledBtn(h,!1),f(0,h,e,c))})();c=Number(b.hits.news);e=Number(b.hits.bars);0==e&&"Bar"==f&&0<c&&$($(".screen-compteur").find("a")[1]).click();0==c&&"News"==f&&0<e&&$($(".screen-compteur").find("a")[0]).click();setTimeout(function(){if(b.hits&&b.hits.found){var a=b.hits.found,c=$(".display-bar-width-list-parent .bar-w-pic").length;c<a?($(".loadmore-trigger").each(function(){$(this).text($(this).attr("data-text"))}),start=c,"Bar"==f?($(".load-more-bars-btn").show(),
$(".load-more-news-btn").hide()):($(".load-more-bars-btn").hide(),$(".load-more-news-btn").show())):($(".load-more-bars-btn").hide(),$(".load-more-news-btn").hide())}},100)};a.getSearchResult=function(b,c){$(".loader-search-page").show();$(".load-more-bars-btn").hide();$(".load-more-news-btn").hide();var e;e=from_loadMore?istablet?3:ismobile?6:12:12;var l="/app_dev.php"!=URL_MODE?"":URL_MODE;lastConsultedURL=getBaseURL()+l+"/search?entity="+f+"&"+b+(""!=h?"&"+h:"")+("&limit="+e)+("&start="+start)+
(""!=m?m:"");globalAjaxCode&&globalAjaxCode.abort();globalAjaxCode=$.get(lastConsultedURL,function(b){a.generateListByResults(b,c)});currentFilterLoaded=f};a._selectCities=function(b){if(!b||""==b||1==b.length)return m="",!1;m="&city="+b;a.clearContent();start=0;a.goSearch();var c=a.context.$form_filter.find(".neigborhood");$.get(Routing.generate("wbb_city_suburbs",{citySlug:b}),function(e){var f='<li class="h4 radio-container"><label><input type="checkbox" name="neigborhoods" value="all"/><b></b>All neighborhood</label><div '+
(640<$(window).width()&&7<e.suburbs.length?'class="custom-scroll"':'class="without-scroll"')+'><ul class="checkbox-container">',h="";$.each(e.suburbs,function(b,c){h+='<li><label><input type="checkbox" class="neigborhood-checkbox" name="district[]" value="'+a.escapit(c.name)+'"/><b></b>'+c.name+"</label></li>"});f=f+h+'</ul><br class="clear"/></div></li>';c.find("ul").html(f);c.find(".custom-scroll").each(function(){$(this).jScrollPane({autoReinitialise:!0,hideFocus:!0})});""!=b&&c.slideDown();a.setUpEventFilterAjax()})};
a.goSearch=function(b){a.getSearchResult(b?b:"q="+currentQuery,function(){var a=$(".sort-by").find(".active");$(a).attr("data-index");$(a).hasClass("grid")?($(".display-bar-width-picture-parent").show(),$(".display-bar-width-list-parent").hide()):$(a).hasClass("list")&&($(".display-bar-width-picture-parent").hide(),$(".display-bar-width-list-parent").show())});return!1};a.desibledBtn=function(a,c){c?(a.removeClass("disabled-search"),a.removeAttr()):(a.addClass("disabled-search"),a.attr("disabled",
"disabled"))};a.getCurrentTabActive=function(){f=0==$(".screen-compteur .active").attr("data-index")?"Bar":"News"};a.generateUrlFromCheckBox=function(){a.context.$form_filter.serializeArray();var b=[];a.context.$form_filter.find("input[type=checkbox]:checked").not("input[name=neigborhoods]").each(function(){var a=$(this);b[a.attr("name")]||(b[a.attr("name")]=[]);b[a.attr("name")].push(a.val())});h="";start=0;for(k in b)h+=k.substr(0,k.length-2)+"="+b[k].join(",")+"&";h=h.substr(0,h.length-1)};a._filterResults=
function(){a.generateUrlFromCheckBox();compteurNews=compteurBars=0;ismobile||(a.getCurrentTabActive(),a.clearContent(),a.goSearch())};a._setupEvents=function(){a.context.$form_filter.find(".drop-btn a").click(function(b,c){$(this).hasClass("plus")?($(this).addClass("minus").removeClass("plus").parent().next(".drop-list").stop().slideDown(a.config.speed),a.context.$form_filter.find('.reset input[type="reset"]').show(),c&&c()):$(this).addClass("plus").removeClass("minus").parent().next(".drop-list").stop().slideUp(a.config.speed);
a.context.$form_filter.find(".custom-scroll").each(function(){var a=$(this).data("jsp");"undefined"!=typeof a&&a.reinitialise()})});a.context.$form_search.find("input[type=text]").on("keyup",function(){0<$(this).val().length?$(this).next().next().show():$(this).next().next().hide()});a.context.$form_search.find("input[type=reset]").click(function(){a.context.$form_search.find("#city_search").val("");$(this).hide();return!1});a.context.$form_filter.find("input[type=reset]").not(".no-action-search-cancel").click(function(b,
c){ismobile&&b.preventDefault();!c&&ismobile?(a.getCurrentTabActive(),start=0,a.clearContent(),a.goSearch()):c||(limit=0,h="",start=0,m="",a.clearContent(),a.goSearch());$(this).hide();if(!ismobile){if(!c||c&&"from_constracter"!=c)h="";start=0;m="";a.context.$form_filter.find(".drop-btn a.minus").click();$("select.select2-dropdown").select2("val","");$("select.select2-dropdown").select2("data",null);$("select.select2-dropdown").select2({placeholder:"Choose a City",allowClear:!0});$(".city-drop-down").val("");
setTimeout(function(){a.context.$form_filter.find(".neigborhood > ul").empty();a.context.$form_filter.find(".neigborhood").hide()},a.config.speed);(!c||c&&"from_constracter"!=c)&&$("#filter input[type=checkbox]").prop("checked",!1)}if(ismobile)return!1});a.context.$form_filter.find(".no-action-search-cancel").click(function(){h="";start=0;m="";a.context.$form_filter.find(".drop-btn a.minus").click();$(".city-drop-down").parent(".ui-dropdown-container").find(".selected").text("Choose a City");$("select.select2-dropdown").select2("val",
"");$("select.select2-dropdown").select2("data",null);$("select.select2-dropdown").select2({placeholder:"Choose a City",allowClear:!0});$(".city-drop-down").val("");setTimeout(function(){a.context.$form_filter.find(".neigborhood > ul").empty();a.context.$form_filter.find(".neigborhood").hide()},a.config.speed);$("#filter input[type=checkbox]").prop("checked",!1);a.clearContent();a.goSearch()});a.context.$form_filter.find("select[name=city]").change(function(){a._selectCities($(this).val())});a._radioEvents();
a._checkboxEvents();$(".screen-compteur").find("a").click(function(){var b=$($(this).find("input[type=radio]")[0]).attr("data-type");if($(this).hasClass("disabled-search")||b==currentFilterLoaded)return!1;start=0;b=$(this).attr("data-index");a.clearContent();f=0==b?"Bar":"News";$(".load-more-bars-btn").hide();$(".load-more-news-btn").hide();a.goSearch();currentFilterLoaded=f;return!1});a.setUpEventFilterAjax();$(".sort-by a.grid").attr("data-index",0);$(".sort-by a.list").attr("data-index",1);$(".sort-by a.grid").add(".sort-by a.list").on("click",
function(){$(this).attr("data-index");$(this).hasClass("grid")?($(".display-bar-width-picture-parent").show(),$(".display-bar-width-list-parent").hide()):$(this).hasClass("list")&&($(".display-bar-width-picture-parent").hide(),$(".display-bar-width-list-parent").show());return!1});$(".loadmore-trigger").on("click",function(b){b.preventDefault();$(this).text(TRAD.common.loading);from_loadMore=!0;a.goSearch();return from_loadMore=!1});$("#search").on("submit",function(){start=0;var b=$(this).find("input[type=text]").val();
""!=b&&(a.clearContent(),currentQuery=b,a.goSearch("q="+currentQuery));return!1});$("#applay-filter").off("click").on("click",function(){a.clearContent();a.goSearch();$(".bar-filter-form, .bar-filter").fadeIn(function(){ismobile&&$("html, body").animate({scrollTop:0},500,"easeInOutCubic")});$(".search-bar-mobile.search-area").show();640>$(window).width()&&$("aside.filters").hide();ismobile&&$("html, body").animate({scrollTop:0},500,"easeInOutCubic");return!1});a.context.$form_filter.on("submit",function(){a.clearContent();
a.goSearch();return!1})};a.setUpEventFilterAjax=function(){a.context.$form_filter.find("input[type=checkbox]").not("input[name=neigborhoods]").off("change").on("change",function(b){currentFilterLoaded="";a._filterResults()});$("input[name=neigborhoods]").off("change").on("change",function(){$(this).is(":checked")?$("input.neigborhood-checkbox").prop("checked",!0):$("input.neigborhood-checkbox").prop("checked",!1);$("input.neigborhood-checkbox").change()});$("input.neigborhood-checkbox").change(function(){var a=
$("input.neigborhood-checkbox:checked").length;$("input.neigborhood-checkbox").length==a?$("input[name=neigborhoods]").prop("checked",!0):$("input[name=neigborhoods]").prop("checked",!1)})};a._animate=function(b,c,e){b.show().height();c.css({opacity:0,top:"6em",position:"relative"}).each(function(b){$(this).delay(100*(b+1)).velocity({opacity:1,top:0},a.config.speed,a.config.easing)});setTimeout(function(){e&&e()},100*c.length+a.config.speed)};a._radioEvents=function(){a.context.$form_filter.on("change",
"input[type=radio]",function(){$(this).closest("form").find("input[name="+$(this).attr("name")+"]").parent().next().find("input[type=checkbox]").prop("checked",!1)})};a._checkboxEvents=function(){a.context.$form_filter.on("change","input[type=checkbox]",function(){var a=$(this).closest(".radio-container").find("input[type=radio]");a.prop("checked",!0);a.closest("form").find("input[name="+a.attr("name")+"]").not(a).closest(".radio-container").find("input[type=checkbox]").prop("checked",!1)})};a.initSearchQueryMode=
function(){var b=function(){currentQuery=queryestQ&&"undefined"!=queryestQ?""==queryestQ?"*":queryestQ:"*"},c=function(){a.generateUrlFromCheckBox();""!=h&&(b(),a.goSearch(),searchedByQuery=!0)};setTimeout(function(){a.context.$form_filter.find("input[type=checkbox]:checked").not("input[name=neigborhoods]");var e=0,f;$(".filter-tags-check").each(function(){$(this).attr("checked")&&(e++,f=$(this),$(this).prop("checked",!0))});e&&f?f.closest("li.grouped-fields-search").find(".drop-btn a").trigger("click",
[c]):(b(),a.goSearch())},100)};a.__construct=function(){a._setupContext();a._setupEvents();$($(".screen-compteur").find("a")[0]).attr("data-index",0);$($(".screen-compteur").find("a")[1]).attr("data-index",1);a.getCurrentTabActive();a.initSearchQueryMode();$(".screen-compteur .ui-radio").addClass("collapsed");$(".load-more-bars-btn").hide();$(".load-more-news-btn").hide();a.context.$form_filter.find("select[name=city]")[0].selectedIndex=0;a.context.$form_filter.find("input[type=reset]").trigger("click",
["from_constracter"])};a.__construct()};$(document).ready(function(){$("form#filter").length&&(new meta.SearchPage,$("select.select2-dropdown").select2({placeholder:"Choose a City",allowClear:!0,minimumResultsForSearch:5,dropdownCssClass:"select2-search-filter white-style",containerCssClass:"select2-search-filter white-style",sortResults:function(a,f,h){return h.term?a.sort(function(a,b){return a.text>b.text?1:a.text<b.text?-1:0}):a}}))});
function getBaseURL(){var a=location.href,a=a.substring(0,a.indexOf("/",14));if(-1!=a.indexOf("http://localhost")){var a=location.href,f=a.indexOf(location.pathname),f=a.indexOf("/",f+1);return a.substr(0,f)}return a};
